# Mysql优化，高级学习

### 1、索引优化问题 B+树

* 索引的本质：
  * 索引是帮助Mysql高效获取数据的排好序的数据结构
  * 索引存储在文件里
  * 索引结构
    * 二叉树  索引递增
    * 红黑树  
    * HASH
    * BTREE



### mysql不能用 Hash 当索引（不能进行范围查找，联合索引时不支持部分索引查询）hash的效率是最高的

### mysql也不能用红黑树，大数据量的时候树太高 磁盘读取次数过多、磁盘读取16K，浪费太多



* 查询条件不会变，而且没有部分查询也没有范围查询的时候可以使用，效率最高



### Mysql索引需要使用到 n叉树，解决红黑树索引的问题



### 2、B树：B-Tree,B+Tree,B*Tree



### 2.1B-Tree(二叉排序树)：N叉的排序树

#### 1.M介的B-Tree的几个重要特性：

* 结点最多含有m颗子树（指针），m-1个关键字（数据）（m >= 2）

* 除根节点和叶子结点外，其它每个结点至少有ceil(m/2)个子节点（子树），ceil为向上取整；5/2=2.5取整，分裂  Ceil取上整数 2.5=> 3;    2.1=>3

* 若根节点不是叶子结点，则至少有两颗子树

* B-Tree 有一个非常重要的操作：当一棵树不满足以上性质的时候会干嘛？（红黑树会进行左旋和右旋），**不满足上面的时候会进行 分裂**

* 即通过**分裂**保证前三条性质

  **分裂的时候从中间分开。分成两颗子树**

#### 5介B树的创建过程详细介绍https://blog.csdn.net/a1_HelloWord/article/details/104307914

**B-Tree 在mysql中 会在子结点中存储 mysql 中数据的 地址，叶子节点和其它结点都会存贮 数据的磁盘地址，结点开销变大，存储内容会多**

**B-Tree 没法做 范围查找：如查询小于100的数据，需要把100结点的左子树进行遍历，索引会失去意义**

************************************************************

### 2.2 B+Tree（数据存放在叶子节点，根和子节点只存放键值跟指针，可以放很多建+指针  树的结构变矮）

#### 1.与B-Tree的区别

* 叶子节点连起来了    **使用的双向链表：用来解决范围查找；当索引失效，需要读取所有数据时，只需要找到开始的叶子节点，就能获取所有数据**
* 非叶子节点不存数据    
* 数据和节点一样多    **B+树分裂的时候 需要将最大或最小的数据上升上去**



#### B+树的详细介绍：**https://www.cnblogs.com/nullzx/p/8729425.html**



## Mysql索引的阶数，如何进行计算

#### mysql中的阶（每个节点存放几个key值）：根据数据量计算出来的，根据什么数据量计算的呢？

阶 根据 磁盘上的页计算出来的；如果磁盘的每一页是16K 那么会根据创建的索引的值大小进行计算，看16k 可以存放多少个字段

**根据磁盘的页的大小与要创建的索引字段的类型与大小进行计算，从而得到这个索引是几阶的B+Tree**

### **关于组合索引**

* **创建索引的原则：最左原则，最左匹配原则**
* **多个字段创建联合索引时，只会根据最左边的字段的创建B+Tree 创建索引，只不过在叶子节点的时候存放的是这联合索引的字段信息**





# 总结

二叉查找树，红黑树，B-Tree，B+Tree 的区别

二叉查找树：二叉搜索树，优点查找快，但在某些情况下会退化成链表，它是所有高效查找树的基础

红黑树：内存查找树，不适合大数据量，也不适合磁盘存储。具体的分析就是IO浪费以及读取资源浪费，还有就是树的深度会很大，适合一些底层系统做内存运算

B-Tree：可以认为是B+Tree过度，只需要知道B-Tree就可以

B+Tree：最适合大数据的磁盘索引，经典的Mysql，所有的数据都存放在叶子节点。其他都是索引，增加了系统的稳定性以及遍历以及查找效率





不同：关键字和Key值。数据存储的地方，双向链表

M阶：这个由磁盘的页面大小决定，磁盘块和也内存都是4KB。我们的节点数也就是我们的M值 应该要尽可能的跟他一样，这样的好处就是为了我们一次刚好能全部拿出一个节点里面的所有的数据。



